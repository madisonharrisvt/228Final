<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/three.js/r66/three.js"></script>
    <script src="//js.leapmotion.com/leap-0.6.2.min.js"></script>
    <script src="//js.leapmotion.com/leap-plugins-0.1.6.1.js"></script>
    <script src="//js.leapmotion.com/leap.rigged-hand-0.1.3.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato:100,400,900,100italic,400italic">

  <script type=text/javascript>
    // $(function() {


    //   $('a#calculate').bind('click', function() {
    //     $.getJSON('/_knn', {
    //       a: $('input[name="a"]').val(),
    //       b: $('input[name="b"]').val()
    //     }, function(data) {
    //       $("#result").text(data.result);
    //     });
    //     return false;
    //   });

      //$('a#calculate').bind('click', function() {
      //  $.getJSON('/testendpoint', {
      //    num $('input[name="a"]').val(),
      //  }, function(data) {
      //    $("#result").text(data.result);
      //  });
      //  return false;
      //});
    //});
  </script>
  <style>
    *{
      font-family: "Lato", sans-serif;
    }
    body {
        background-color: #C2E6FF;
    }
    #numbers{
      position:fixed; 
      width:100%; 
      bottom:0px;
      text-align: center;
    }
  </style>
  </head>
  <body>
    <!-- <p id = "result">5.0</p>
    <p id = "data">5.0</p> -->
    <!-- <div class="container">
      <div class="header">
        <h3 class="text-muted">How To Manage JSON Requests</h3>
      </div>
      <hr/>
      <div>
      <p>
    <input type="text" size="5" name="a"> +
    <input type="text" size="5" name="b"> =
    <span id="result">?</span>
    <p><a href="javascript:void();" id="calculate">calculate server side</a>
      </form>
      </div>
    </div> -->
    <div id="numbers">
     <svg width="120" height="120">
       <circle id = "zeroCircle" cx="60" cy="60" r="45" stroke="#0099FF" stroke-width="7" fill="#0099FF" />
       <text id = "zeroText" x="60" y="80"
             font-family="sans-serif"
             font-size="50px"
             text-anchor="middle"
             fill="white">0</text>
     </svg>
     <svg width="120" height="120">
       <circle id = "oneCircle" cx="60" cy="60" r="45" stroke="#0099FF" stroke-width="7" fill="#0099FF" />
       <text id = "oneText" x="60" y="80"
             font-family="sans-serif"
             font-size="50px"
             text-anchor="middle"
             fill="white">1</text>
     </svg>
     <svg width="120" height="120">
       <circle id = "twoCircle" cx="60" cy="60" r="45" stroke="#0099FF" stroke-width="7" fill="#0099FF" />
       <text id = "twoText" x="60" y="80"
             font-family="sans-serif"
             font-size="50px"
             text-anchor="middle"
             fill="white">2</text>
     </svg>
     <svg width="120" height="120">
       <circle id = "threeCircle" cx="60" cy="60" r="45" stroke="#0099FF" stroke-width="7" fill="#0099FF" />
       <text id = "threeText" x="60" y="80"
             font-family="sans-serif"
             font-size="50px"
             text-anchor="middle"
             fill="white">3</text>
     </svg>
     <svg width="120" height="120">
       <circle id = "fourCircle" cx="60" cy="60" r="45" stroke="#0099FF" stroke-width="7" fill="#0099FF" />
       <text id = "fourText" x="60" y="80"
             font-family="sans-serif"
             font-size="50px"
             text-anchor="middle"
             fill="white">4</text>
     </svg>
     <svg width="120" height="120">
       <circle id = "fiveCircle" cx="60" cy="60" r="45" stroke="#0099FF" stroke-width="7" fill="#0099FF" />
       <text id = "fiveText" x="60" y="80"
             font-family="sans-serif"
             font-size="50px"
             text-anchor="middle"
             fill="white">5</text>
     </svg>
     <svg width="120" height="120">
       <circle id = "sixCircle" cx="60" cy="60" r="45" stroke="#0099FF" stroke-width="7" fill="#0099FF" />
       <text id = "sixText" x="60" y="80"
             font-family="sans-serif"
             font-size="50px"
             text-anchor="middle"
             fill="white">6</text>
     </svg>
     <svg width="120" height="120">
       <circle id = "sevenCircle" cx="60" cy="60" r="45" stroke="#0099FF" stroke-width="7" fill="#0099FF" />
       <text id = "sevenText" x="60" y="80"
             font-family="sans-serif"
             font-size="50px"
             text-anchor="middle"
             fill="white">7</text>
     </svg>
     <svg width="120" height="120">
       <circle id = "eightCircle" cx="60" cy="60" r="45" stroke="#0099FF" stroke-width="7" fill="#0099FF" />
       <text id = "eightText" x="60" y="80"
             font-family="sans-serif"
             font-size="50px"
             text-anchor="middle"
             fill="white">8</text>
     </svg>
     <svg width="120" height="120">
       <circle id = "nineCircle" cx="60" cy="60" r="45" stroke="#0099FF" stroke-width="7" fill="#0099FF" />
       <text id = "nineText" x="60" y="80"
             font-family="sans-serif"
             font-size="50px"
             text-anchor="middle"
             fill="white">9</text>
     </svg>
  </div>
    <div id="labels"></div>
  </body>
  <script type="text/javascript" class="codepen">

    var numberToSign = 0;
    var handRecording;

    if(numberToSign == 0){
        handRecording = './zerofps.json.lz';
      }

    if(numberToSign == 0){
      $('#zeroCircle').attr('stroke','White');
      $('#oneCircle').attr('stroke','#0099FF');
      $('#twoCircle').attr('stroke','#0099FF');
    } else if(1 == numberToSign){
      $('#oneCircle').attr('stroke','White');
      $('#zeroCircle').attr('stroke','#0099FF');
      $('#twoCircle').attr('stroke','#0099FF');
    } else if(2 == numberToSign){
      $('#twoCircle').attr('stroke','White');
      $('#zeroCircle').attr('stroke','#0099FF');
      $('#oneCircle').attr('stroke','#0099FF');
    }
    else{
      $('#zeroCircle').attr('stroke','#0099FF');
      $('#oneCircle').attr('stroke','#0099FF');
      $('#twoCircle').attr('stroke','#0099FF');
    }

    function knnAlgorithm(stringToPass){
      $.getJSON('/_knn', {
        a: stringToPass
      }, function(data) {
        //$("#zero").text(data.result);
        if(data.result == 0){
          $('#zeroCircle').attr('fill','#47B56C');
          $('#oneCircle').attr('fill','#0099FF');
          $('#twoCircle').attr('fill','#0099FF');
        } else if(data.result == 1){
          $('#oneCircle').attr('fill','#47B56C');
          $('#zeroCircle').attr('fill','#0099FF');
          $('#twoCircle').attr('fill','#0099FF');
        } else if(data.result == 2){
          $('#twoCircle').attr('fill','#47B56C');
          $('#zeroCircle').attr('fill','#0099FF');
          $('#oneCircle').attr('fill','#0099FF');
        }
        else{
          $('#zeroCircle').attr('fill','#0099FF');
          $('#oneCircle').attr('fill','#0099FF');
          $('#twoCircle').attr('fill','#0099FF');
        }
      });
    }

    // if($('#circle').text() == 1){
    //   handRecording = './onefps.json.lz'
    // }
    // else if($('#circle').text() == 2){
    //   handRecording = './twofps.json.lz'
    // }

    var riggedHandPlugin;

    var timer = 0;

    Leap.loop({

      hand: function(hand){
        var label = hand.data('label');

        timer = timer + 1;

        // if (!label){

        //   label = document.createElement('label');
        //   document.body.appendChild(label);


        //   /**
        //    * Here we set the label to show the hand type
        //    */
          
        //   result.innerHTML = hand.fingers[1].tipPosition[0];
        //   //label.innerHTML = hand.confidence * 100;
        //   hand.data('label', label)

        // }else {result.innerHTML = hand.fingers[1].tipPosition[0];
        //   //label.innerHTML = hand.confidence * 100;
        // }

      //   for i in range(0,5):
      // finger = hand.fingers[i] # Set finger data
      // for j in range(0,4):
      //   bone = finger.bone(j)
      //   boneBase = bone.prev_joint
      //   boneTip = bone.next_joint
      //   xBase = boneBase[0]
      //   yBase = boneBase[1]
      //   zBase = boneBase[2]
      //   xTip = boneTip[0]
      //   yTip = boneTip[1]
      //   zTip = boneTip[2]

      if(numberToSign == 0){
        handRecording = './zerofps.json.lz';
      }
      else if(numberToSign == 1){
        handRecording = './onefps.json.lz';
      }
      else if(numberToSign == 2){
        handRecording = './twofps.json.lz';
      }

        var stringToPass = "";
        for(i = 0; i < 5; i++){
          var finger = hand.fingers[i];

          for(j = 0; j < 4; j++){
            var bone = finger.bones[j];
            var boneBase = bone.prevJoint;
            var boneTip = bone.nextJoint;
            var xTip = boneTip[0];
            var yTip = boneTip[1];
            var zTip = boneTip[2];

            if( (j==0) || (j==3) ){
              stringToPass += xTip + ",";
              stringToPass += yTip + ",";
              stringToPass += zTip + ",";
            }
          }
        }

        //result.innerHTML = stringToPass;

        if(timer % 80 == 0){
          knnAlgorithm(stringToPass); 
        }

        var handMesh = hand.data('riggedHand.mesh');

        var screenPosition = handMesh.screenPosition(
          hand.palmPosition,
          riggedHandPlugin.camera
        );

        // label.style.left = screenPosition.x + 'px';
        // label.style.bottom = screenPosition.y + 'px';

      }
    })
    .use('riggedHand', {
        scale: 1.5,
        boneColors: function (boneMesh, leapHand){
          return {
            hue: 0.33,
            saturation: leapHand.confidence,
            lightness: 1.0
          }
        }
      })
    .use('handEntry')
    .on('handLost', function(hand){
        var label = hand.data('label');
        if (label){
          document.body.removeChild(label);
          hand.data({label: undefined});
        }
    })
    .use('playback', {
      recording: handRecording,
      timeBetweenLoops: 1000
    });

    riggedHandPlugin = Leap.loopController.plugins.riggedHand;

  </script>
</html>